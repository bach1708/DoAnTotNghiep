@model IEnumerable<MangaShop.Models.Truyen>

@{
    ViewData["Title"] = "Quản lý truyện";
    Layout = "_AdminLayout";
}

<link rel="stylesheet" href="~/css/NvbTruyen-Index.css" />

<div class="manga-admin-wrapper">
    <div class="manga-header">
        <div class="header-info">
            <h2 class="manga-title">QUẢN LÝ TRUYỆN</h2>
            <p class="manga-subtitle">Danh sách kho truyện đang kinh doanh trên hệ thống</p>
        </div>
        <div class="header-actions">
            <a asp-action="Create" class="manga-btn btn-dark">
                <i class="fa-solid fa-plus"></i> Thêm truyện mới
            </a>
            <a asp-action="NhapKhoTap" class="manga-btn btn-light-border">
                <i class="fa-solid fa-boxes-stacked"></i> Nhập kho
            </a>
            <a asp-action="Trash" class="manga-btn btn-outline-danger">
                <i class="fa-solid fa-trash-can"></i> Thùng rác
            </a>
            <a asp-controller="NvbAdmin" asp-action="Index" class="manga-btn btn-secondary">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
        </div>
    </div>

    <div class="manga-card shadow-sm">
        <div class="table-responsive">
            <table class="manga-table">
                <thead>
                    <tr>
                        <th class="text-center" style="width: 80px">Ảnh</th>
                        <th>Tên truyện</th>
                        <th>Truyện</th>
                        <th>Thể loại & Tác giả</th>
                        <th class="text-center">Bộ</th>
                        <th class="text-center">Còn</th>
                        <th class="text-center">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        var soTap = item.TruyenTaps?.Count ?? 0;
                        var tongTon = item.TruyenTaps?.Sum(x => x.SoLuongTon) ?? 0;

                        <tr>
                            <td class="text-center">
                                <div class="manga-thumbnail mx-auto">
                                    <img src="~/images/@item.AnhBia" onerror="this.src='/images/no-image.png'" />
                                    @if (item.IsDeleted)
                                    {
                                        <div class="badge-hidden">Ẩn</div>
                                    }
                                </div>
                            </td>
                            <td>
                                <div class="manga-name">@item.TenTruyen</div>
                                <div class="manga-id">ID: #@item.MaTruyen</div>
                            </td>
                            <td>
                                <span class="badge-type @(item.LoaiTruyen == 0 ? "type-comic" : "type-novel")">
                                    @(item.LoaiTruyen == 0 ? "Tranh" : "Chữ")
                                </span>
                            </td>
                            <td>
                                <div class="meta-item"><i class="fa-solid fa-user-pen"></i> @item.TacGia</div>
                                <div class="meta-item"><i class="fa-solid fa-tag"></i> @item.MaTheLoaiNavigation?.TenTheLoai</div>
                            </td>
                            <td class="text-center">
                                <div class="vol-count">@soTap <small class="unit-text">tập</small></div>
                            </td>
                            <td class="text-center">
                                @if (soTap == 0)
                                {
                                    <span class="stock-tag stock-none">-</span>
                                }
                                else if (tongTon <= 0)
                                {

                                    <span class="stock-tag stock-out">Hết</span>
                                }
                                else
                                {

                                    <span class="stock-tag stock-ok">@tongTon <small class="unit-text">quyển</small></span>
                                }
                            </td>
                            <td class="text-center">
                                <div class="action-flex">
                                    <a asp-action="Edit" asp-route-id="@item.MaTruyen" class="act-link" title="Sửa">
                                        <i class="fa-solid fa-pen"></i>
                                    </a>
                                    <a asp-controller="NvbTruyen" asp-action="ThemTap" asp-route-id="@item.MaTruyen" class="act-link" title="Quản lý tập">
                                        <i class="fa-solid fa-layer-group"></i>
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@item.MaTruyen" class="act-link delete" title="Xóa" onclick="return confirm('Xác nhận ẩn/xóa?')">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>