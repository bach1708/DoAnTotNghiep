@using MangaShop.Models
@{
    ViewData["Title"] = "Đánh giá sản phẩm";
    int maTruyen = (int)ViewBag.MaTruyen;
    int maDonHang = (int)ViewBag.MaDonHang;
    var truyen = ViewBag.Truyen as MangaShop.Models.Truyen;
    var tapsDaMua = ViewBag.TapsDaMua as List<TruyenTap> ?? new List<TruyenTap>();
}

<link rel="stylesheet" href="~/css/DanhGia-User.css" />

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="rating-container">
                <h4 class="mb-4 fw-bold text-uppercase"><i class="fa-solid fa-pen-to-square me-2"></i>Đánh giá truyện</h4>

                @if (truyen != null)
                {
                    <div class="product-info-box border">
                        <img src="~/images/@truyen.AnhBia" class="product-img" />
                        <div>
                            <h5 class="mb-1 fw-bold text-dark">@truyen.TenTruyen</h5>
                            <p class="text-muted small mb-0">Đơn hàng: #@maDonHang</p>
                            <p class="text-muted small mb-0">Tác giả: @truyen.TacGia</p>
                        </div>
                    </div>
                }

                @if (TempData["Err"] != null)
                {
                    <div class="alert alert-danger">@TempData["Err"]</div>
                }

                <form asp-controller="DanhGia" asp-action="Create" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="MaTruyen" value="@maTruyen" />
                    <input type="hidden" name="MaDonHang" value="@maDonHang" />

                    <div class="mb-4">
                        <label class="form-label fw-bold"><i class="fa-solid fa-list-check me-2"></i>Bạn muốn đánh giá tập nào?</label>
                        <div class="tap-selector mt-2">
                            @foreach (var t in tapsDaMua)
                            {
                                <div class="tap-item">
                                    <input type="checkbox" name="maTaps" value="@t.MaTap" id="tap_@t.MaTap" checked />
                                    <label for="tap_@t.MaTap">Tập @t.SoTap</label>
                                </div>
                            }
                        </div>
                        <div class="form-text mt-2 italic">* Chỉ hiển thị các tập bạn đã mua trong đơn hàng này.</div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold"><i class="fa-solid fa-star me-2"></i>Chất lượng sản phẩm</label>
                        <select name="SoSao" class="form-select star-select" required>
                            <option value="5">⭐⭐⭐⭐⭐ Tuyệt vời (5 sao)</option>
                            <option value="4">⭐⭐⭐⭐ Hài lòng (4 sao)</option>
                            <option value="3">⭐⭐⭐ Bình thường (3 sao)</option>
                            <option value="2">⭐⭐ Tệ (2 sao)</option>
                            <option value="1">⭐ Rất tệ (1 sao)</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold"><i class="fa-solid fa-comment-dots me-2"></i>Chia sẻ cảm nhận</label>
                        <textarea name="NoiDung" class="form-control textarea-custom" rows="4"
                                  placeholder="Truyện có đẹp không? Nội dung có hấp dẫn không? Hãy chia sẻ nhé..."></textarea>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-warning px-4 fw-bold shadow-sm">
                            Gửi đánh giá ngay
                        </button>
                        <a asp-controller="Bill" asp-action="BillDetail" asp-route-id="@maDonHang"
                           class="btn btn-light border px-4">
                            Quay lại
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>